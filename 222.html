<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>异次元 AI 助手</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Oxanium:wght@300;400;600&display=swap');
        
        body {
            font-family: 'Oxanium', sans-serif;
            background: #0a0a16;
            color: #e0e0ff;
            overflow-x: hidden;
        }
        
        .stranger-things-bg {
            background: 
                radial-gradient(circle at 20% 30%, rgba(75, 0, 130, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(0, 100, 200, 0.2) 0%, transparent 50%),
                linear-gradient(135deg, #0a0a16 0%, #1a1a2e 50%, #0a0a16 100%);
            position: relative;
        }
        
        .stranger-things-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0, 100, 200, 0.05) 2px, rgba(0, 100, 200, 0.05) 4px),
                repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(75, 0, 130, 0.05) 2px, rgba(75, 0, 130, 0.05) 4px);
            pointer-events: none;
            z-index: 0;
        }
        
        .stranger-header {
            background: rgba(10, 10, 22, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 100, 200, 0.3);
            box-shadow: 0 0 20px rgba(0, 100, 200, 0.2);
        }
        
        .stranger-title {
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            background: linear-gradient(90deg, #ff0080, #8000ff, #0080ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 10px rgba(255, 0, 128, 0.5);
            letter-spacing: 1px;
        }
        
        .stranger-badge {
            background: linear-gradient(135deg, #ff0080, #8000ff);
            color: white;
            font-family: 'Orbitron', monospace;
            font-size: 0.7rem;
            letter-spacing: 1px;
            box-shadow: 0 0 10px rgba(255, 0, 128, 0.5);
        }
        
        .message-container {
            scrollbar-width: thin;
            scrollbar-color: #4a00e0 #0a0a16;
        }
        
        .message-container::-webkit-scrollbar {
            width: 6px;
        }
        
        .message-container::-webkit-scrollbar-track {
            background: #0a0a16;
        }
        
        .message-container::-webkit-scrollbar-thumb {
            background-color: #4a00e0;
            border-radius: 3px;
        }
        
        .user-message {
            animation: slideInRight 0.4s ease-out;
        }
        
        .ai-message {
            animation: slideInLeft 0.4s ease-out;
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .message-bubble {
            border-radius: 18px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .user-bubble {
            background: linear-gradient(135deg, #ff0080 0%, #8000ff 100%);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .ai-bubble {
            background: rgba(20, 20, 40, 0.7);
            border: 1px solid rgba(0, 100, 200, 0.3);
            color: #ffffff;
            backdrop-filter: blur(5px);
        }
        
        .input-container {
            background: rgba(20, 20, 40, 0.7);
            border: 1px solid rgba(0, 100, 200, 0.3);
            backdrop-filter: blur(5px);
        }
        
        .input-container:focus-within {
            box-shadow: 0 0 0 2px rgba(0, 100, 200, 0.5);
            border-color: rgba(0, 100, 200, 0.7);
            transition: all 0.3s ease;
        }
        
        .send-button {
            background: linear-gradient(135deg, #ff0080, #8000ff);
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(255, 0, 128, 0.4);
        }
        
        .send-button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 0, 128, 0.6);
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        .typing-indicator {
            display: inline-block;
            position: relative;
            width: 80px;
            height: 30px;
        }
        
        .typing-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #8e2de2;
            position: absolute;
            animation: typing 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) {
            left: 0;
            animation-delay: 0s;
        }
        
        .typing-dot:nth-child(2) {
            left: 20px;
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            left: 40px;
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                background-color: #8e2de2;
            }
            30% {
                transform: translateY(-10px);
                background-color: #ff0080;
            }
        }
        
        .api-key-input {
            background: rgba(20, 20, 40, 0.7);
            border: 1px solid rgba(0, 100, 200, 0.3);
            color: #e0e0ff;
            transition: all 0.3s ease;
        }
        
        .api-key-input:focus {
            box-shadow: 0 0 0 2px rgba(0, 100, 200, 0.5);
            border-color: rgba(0, 100, 200, 0.7);
        }
        
        .api-key-input::placeholder {
            color: #8a8ac4;
        }
        
        .stranger-panel {
            background: rgba(20, 20, 40, 0.8);
            border: 1px solid rgba(0, 100, 200, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .stranger-select {
            background: rgba(20, 20, 40, 0.7);
            border: 1px solid rgba(0, 100, 200, 0.3);
            color: #e0e0ff;
        }
        
        .stranger-select option {
            background: #1a1a2e;
            color: #e0e0ff;
        }
        
        /* 设置面板样式 */
        #settingsPanel {
            display: none;
            transition: all 0.3s ease;
        }
        
        #settingsPanel.open {
            display: block;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.open {
            display: flex;
        }
        
        .modal-content {
            background: rgba(20, 20, 40, 0.95);
            border: 1px solid rgba(0, 100, 200, 0.5);
            border-radius: 12px;
            padding: 24px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 0 30px rgba(0, 100, 200, 0.3);
            max-height: 80vh;
            overflow-y: auto;
            backdrop-filter: blur(10px);
        }
        
        .api-test-btn {
            background: linear-gradient(135deg, #ff0080, #8000ff);
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(255, 0, 128, 0.3);
        }
        
        .api-test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(255, 0, 128, 0.5);
        }
        
        .test-success {
            background: linear-gradient(135deg, #00b09b, #96c93d);
            color: white;
        }
        
        .test-failure {
            background: linear-gradient(135deg, #ff416c, #ff4b2b);
            color: white;
        }
        
        .api-guide {
            background: rgba(0, 100, 200, 0.1);
            border-left: 4px solid #0080ff;
        }
        
        .model-info {
            background: rgba(0, 100, 200, 0.1);
            border-radius: 8px;
            padding: 12px;
            margin-top: 8px;
            font-size: 0.75rem;
            border: 1px solid rgba(0, 100, 200, 0.2);
        }
        
        .model-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            margin-right: 6px;
            margin-bottom: 4px;
        }
        
        .tag-general {
            background: rgba(0, 100, 200, 0.3);
            color: #8ac6ff;
        }
        
        .tag-reasoning {
            background: rgba(0, 200, 100, 0.3);
            color: #8affc6;
        }
        
        .tag-latest {
            background: rgba(150, 0, 200, 0.3);
            color: #d08aff;
        }
        
        .tag-experimental {
            background: rgba(200, 100, 0, 0.3);
            color: #ffc68a;
        }
        
        .token-info {
            background: rgba(200, 150, 0, 0.2);
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 0.75rem;
            margin-top: 8px;
            border: 1px solid rgba(200, 150, 0, 0.3);
        }
        
        .glitch-text {
            position: relative;
            display: inline-block;
        }
        
        .glitch-text::before,
        .glitch-text::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .glitch-text::before {
            left: 2px;
            text-shadow: -2px 0 #ff0080;
            clip: rect(44px, 450px, 56px, 0);
            animation: glitch-anim 5s infinite linear alternate-reverse;
        }
        
        .glitch-text::after {
            left: -2px;
            text-shadow: -2px 0 #00ffff;
            clip: rect(44px, 450px, 56px, 0);
            animation: glitch-anim2 5s infinite linear alternate-reverse;
        }
        
        @keyframes glitch-anim {
            0% {
                clip: rect(31px, 9999px, 15px, 0);
            }
            5% {
                clip: rect(64px, 9999px, 63px, 0);
            }
            10% {
                clip: rect(20px, 9999px, 45px, 0);
            }
            15% {
                clip: rect(18px, 9999px, 77px, 0);
            }
            20% {
                clip: rect(83px, 9999px, 58px, 0);
            }
            25% {
                clip: rect(55px, 9999px, 39px, 0);
            }
            30% {
                clip: rect(12px, 9999px, 12px, 0);
            }
            35% {
                clip: rect(57px, 9999px, 43px, 0);
            }
            40% {
                clip: rect(47px, 9999px, 3px, 0);
            }
            45% {
                clip: rect(25px, 9999px, 22px, 0);
            }
            50% {
                clip: rect(30px, 9999px, 57px, 0);
            }
            55% {
                clip: rect(83px, 9999px, 37px, 0);
            }
            60% {
                clip: rect(47px, 9999px, 63px, 0);
            }
            65% {
                clip: rect(81px, 9999px, 75px, 0);
            }
            70% {
                clip: rect(59px, 9999px, 74px, 0);
            }
            75% {
                clip: rect(12px, 9999px, 38px, 0);
            }
            80% {
                clip: rect(89px, 9999px, 20px, 0);
            }
            85% {
                clip: rect(43px, 9999px, 72px, 0);
            }
            90% {
                clip: rect(24px, 9999px, 59px, 0);
            }
            95% {
                clip: rect(82px, 9999px, 40px, 0);
            }
            100% {
                clip: rect(64px, 9999px, 29px, 0);
            }
        }
        
        @keyframes glitch-anim2 {
            0% {
                clip: rect(65px, 9999px, 100px, 0);
            }
            5% {
                clip: rect(52px, 9999px, 74px, 0);
            }
            10% {
                clip: rect(79px, 9999px, 85px, 0);
            }
            15% {
                clip: rect(75px, 9999px, 5px, 0);
            }
            20% {
                clip: rect(67px, 9999px, 61px, 0);
            }
            25% {
                clip: rect(14px, 9999px, 79px, 0);
            }
            30% {
                clip: rect(1px, 9999px, 66px, 0);
            }
            35% {
                clip: rect(86px, 9999px, 30px, 0);
            }
            40% {
                clip: rect(23px, 9999px, 98px, 0);
            }
            45% {
                clip: rect(85px, 9999px, 72px, 0);
            }
            50% {
                clip: rect(71px, 9999px, 75px, 0);
            }
            55% {
                clip: rect(2px, 9999px, 48px, 0);
            }
            60% {
                clip: rect(30px, 9999px, 16px, 0);
            }
            65% {
                clip: rect(59px, 9999px, 50px, 0);
            }
            70% {
                clip: rect(41px, 9999px, 62px, 0);
            }
            75% {
                clip: rect(2px, 9999px, 82px, 0);
            }
            80% {
                clip: rect(47px, 9999px, 73px, 0);
            }
            85% {
                clip: rect(3px, 9999px, 27px, 0);
            }
            90% {
                clip: rect(40px, 9999px, 17px, 0);
            }
            95% {
                clip: rect(22px, 9999px, 38px, 0);
            }
            100% {
                clip: rect(53px, 9999px, 49px, 0);
            }
        }
        
        .pulse-glow {
            animation: pulse-glow 2s infinite;
        }
        
        @keyframes pulse-glow {
            0% {
                box-shadow: 0 0 5px rgba(0, 100, 200, 0.5);
            }
            50% {
                box-shadow: 0 0 20px rgba(0, 100, 200, 0.8);
            }
            100% {
                box-shadow: 0 0 5px rgba(0, 100, 200, 0.5);
            }
        }
        
        /* 时钟样式 */
        .digital-clock {
            font-family: 'Orbitron', monospace;
            font-size: 1.2rem;
            background: linear-gradient(135deg, #ff0080, #8000ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 10px rgba(255, 0, 128, 0.5);
            padding: 5px 10px;
            border-radius: 8px;
            border: 1px solid rgba(255, 0, 128, 0.3);
            box-shadow: 0 0 15px rgba(255, 0, 128, 0.2);
            letter-spacing: 2px;
        }
        
        .clock-container {
            display: flex;
            align-items: center;
            margin-left: auto;
            margin-right: 20px;
        }
        
        .clock-label {
            font-size: 0.8rem;
            color: #8a8ac4;
            margin-right: 8px;
            font-family: 'Oxanium', sans-serif;
        }
        
        /* 图片上传样式 */
        .image-upload-btn {
            background: linear-gradient(135deg, #0080ff, #00ff80);
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 128, 255, 0.3);
        }
        
        .image-upload-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(0, 128, 255, 0.5);
        }
        
        .voice-btn {
            background: linear-gradient(135deg, #ff8000, #ff0080);
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(255, 128, 0, 0.3);
        }
        
        .voice-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255, 128, 0, 0.5);
        }
        
        .voice-btn.recording {
            background: linear-gradient(135deg, #ff0000, #ff4000);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(255, 0, 0, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(255, 0, 0, 0);
            }
        }
        
        .uploaded-image {
            max-width: 300px;
            max-height: 200px;
            border-radius: 8px;
            margin-top: 8px;
            border: 2px solid rgba(0, 100, 200, 0.5);
            box-shadow: 0 0 10px rgba(0, 100, 200, 0.3);
        }
        
        .image-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 8px;
        }
        
        .image-preview {
            position: relative;
            display: inline-block;
        }
        
        .remove-image {
            position: absolute;
            top: -8px;
            right: -8px;
            background: rgba(255, 0, 0, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .file-input {
            display: none;
        }
        
        .input-tools {
            display: flex;
            gap: 8px;
            margin-right: 8px;
        }
        
        .tool-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
    </style>
</head>
<body class="h-screen flex flex-col fade-in stranger-things-bg">
    <!-- 使用指南模态框 -->
    <div id="guideModal" class="modal">
        <div class="modal-content">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold text-white">异次元 AI 助手使用指南</h3>
                <button id="closeGuide" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="space-y-4">
                <div class="api-guide p-4 rounded-lg">
                    <h4 class="font-semibold text-blue-300 mb-2">1. 获取 API 密钥</h4>
                    <p class="text-sm text-gray-300">访问以下网站注册并获取 API 密钥：</p>
                    <ul class="list-disc list-inside text-sm text-gray-400 mt-1 ml-2">
                        <li><a href="https://platform.deepseek.com/api_keys" class="text-blue-400 hover:text-blue-300 hover:underline" target="_blank">API 控制台</a></li>
                    </ul>
                </div>
                
                <div class="api-guide p-4 rounded-lg">
                    <h4 class="font-semibold text-blue-300 mb-2">2. 功能说明</h4>
                    <div class="mt-2 text-xs text-gray-400 space-y-1">
                        <p><strong>图片上传:</strong> 点击图片按钮上传图片进行分析</p>
                        <p><strong>语音输入:</strong> 点击麦克风按钮进行语音输入</p>
                        <p><strong>多模型支持:</strong> 支持多种AI模型切换</p>
                        <p><strong>实时时钟:</strong> 顶部显示当前时间</p>
                    </div>
                </div>
                
                <div class="api-guide p-4 rounded-lg">
                    <h4 class="font-semibold text-blue-300 mb-2">3. 常见问题解决</h4>
                    <div class="text-sm text-gray-300 space-y-2">
                        <p><strong>API密钥无效:</strong> 请检查密钥是否正确复制，是否包含多余空格</p>
                        <p><strong>余额不足:</strong> 请检查您的账户余额</p>
                        <p><strong>模型不可用:</strong> 确保您选择的模型在API中可用</p>
                        <p><strong>请求超时:</strong> 网络连接问题，请检查网络或稍后重试</p>
                    </div>
                </div>
                
                <div class="bg-yellow-900 bg-opacity-30 border border-yellow-700 rounded-lg p-4">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <i class="fas fa-exclamation-triangle text-yellow-400"></i>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-yellow-300">重要提醒</h3>
                            <div class="mt-2 text-sm text-yellow-200">
                                <p>API密钥仅存储在您的浏览器本地，不会发送到任何其他服务器。请妥善保管您的API密钥。</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="flex justify-end mt-6">
                <button id="closeGuideBtn" class="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                    关闭指南
                </button>
            </div>
        </div>
    </div>

    <!-- 顶部标题栏 -->
    <header class="stranger-header py-4 px-6 flex items-center justify-between z-10">
        <div class="flex items-center">
            <div class="w-10 h-10 rounded-full bg-gradient-to-r from-purple-600 to-pink-600 flex items-center justify-center mr-3 shadow-lg pulse-glow">
                <i class="fas fa-robot text-white text-lg"></i>
            </div>
            <h1 class="stranger-title text-xl">异次元 AI 助手</h1>
            <span id="apiStatus" class="ml-2 stranger-badge text-xs font-medium px-2.5 py-0.5 rounded">已连接</span>
        </div>
        
        <!-- 时钟容器 -->
        <div class="clock-container">
            <span class="clock-label">当前时间</span>
            <div id="digitalClock" class="digital-clock"></div>
        </div>
        
        <div class="flex space-x-4">
            <button class="text-gray-400 hover:text-pink-400 transition-colors" id="clearChat" title="清空对话">
                <i class="fas fa-trash-alt"></i>
            </button>
            <button class="text-gray-400 hover:text-blue-400 transition-colors" id="showGuide" title="使用指南">
                <i class="fas fa-question-circle"></i>
            </button>
            <button class="text-gray-400 hover:text-purple-400 transition-colors" id="toggleSettings" title="设置">
                <i class="fas fa-cog"></i>
            </button>
        </div>
    </header>

    <!-- 设置面板 -->
    <div id="settingsPanel" class="stranger-panel border-b border-gray-700 px-6 py-4 z-10">
        <div class="max-w-3xl mx-auto">
            <h3 class="text-sm font-semibold text-blue-300 mb-3">异次元连接设置</h3>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-300 mb-2">选择 AI 服务提供商</label>
                <select id="aiProvider" class="w-full stranger-select rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="deepseek">异次元 AI (推荐)</option>
                    <option value="openai">OpenAI</option>
                    <option value="mock">模拟模式</option>
                </select>
            </div>
            
            <div id="deepseekSection" class="mb-4">
                <label class="block text-sm font-medium text-gray-300 mb-2">API 密钥</label>
                <input type="password" id="apiKey" placeholder="输入您的 API 密钥" 
                       class="api-key-input w-full rounded-lg px-3 py-2 text-sm focus:outline-none mb-2">
                
                <label class="block text-sm font-medium text-gray-300 mb-2">AI 模型</label>
                <select id="deepseekModel" class="w-full stranger-select rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="deepseek-chat">通用对话模型</option>
                    <option value="deepseek-reasoner">推理专用模型</option>
                    <option value="deepseek-v3">V3 版本</option>
                    <option value="deepseek-v3.1">V3.1 版本</option>
                    <option value="deepseek-v3.1-terminus">V3.1 终端版</option>
                    <option value="deepseek-v3.2-exp">V3.2 实验版</option>
                    <option value="deepseek-player-v2">交互专用模型</option>
                </select>
                
                <div class="model-info">
                    <p class="font-medium text-blue-300 mb-1">模型说明:</p>
                    <div class="flex flex-wrap">
                        <span class="model-tag tag-general">通用对话</span>
                        <span class="model-tag tag-reasoning">逻辑推理</span>
                        <span class="model-tag tag-latest">最新版本</span>
                        <span class="model-tag tag-experimental">实验性</span>
                    </div>
                    <p class="text-gray-400 mt-2">选择模型后，系统会自动显示该模型的详细信息和适用场景。</p>
                </div>
                
                <div class="token-info">
                    <p><i class="fas fa-info-circle text-amber-400 mr-1"></i> <strong>提示：</strong>API 使用令牌计费，请合理控制对话长度。</p>
                </div>
            </div>
            
            <div id="openaiSection" class="mb-4 hidden">
                <label class="block text-sm font-medium text-gray-300 mb-2">OpenAI API 密钥</label>
                <input type="password" id="openaiKey" placeholder="输入您的 OpenAI API 密钥" 
                       class="api-key-input w-full rounded-lg px-3 py-2 text-sm focus:outline-none mb-2">
                <label class="block text-sm font-medium text-gray-300 mb-2">OpenAI 模型</label>
                <select id="openaiModel" class="w-full stranger-select rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                    <option value="gpt-4">GPT-4</option>
                </select>
                <p class="text-xs text-gray-500 mt-1">OpenAI 提供免费使用额度，超出后需要付费</p>
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-300 mb-2">API 基础 URL</label>
                <input type="text" id="baseUrl" value="https://api.deepseek.com" 
                       class="api-key-input w-full rounded-lg px-3 py-2 text-sm focus:outline-none">
                <p class="text-xs text-gray-500 mt-1">API 的基础 URL</p>
            </div>
            
            <div class="flex justify-between items-center">
                <button id="testAPI" class="api-test-btn text-white px-4 py-2 rounded-lg text-sm font-medium">
                    测试连接
                </button>
                <button id="saveSettings" class="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                    保存设置
                </button>
            </div>
            
            <div id="testResult" class="mt-4 hidden p-3 rounded-lg text-sm"></div>
        </div>
    </div>

    <!-- 聊天消息显示区 -->
    <main class="flex-1 overflow-y-auto p-4 message-container" id="chatContainer">
        <div class="max-w-3xl mx-auto" id="messageContainer">
            <!-- 消息将通过JavaScript动态添加 -->
        </div>
    </main>

    <!-- 底部输入栏 -->
    <footer class="stranger-header border-t border-gray-700 p-4">
        <div class="max-w-3xl mx-auto">
            <!-- 图片预览区域 -->
            <div id="imagePreviewContainer" class="image-preview-container mb-3 hidden"></div>
            
            <div class="flex items-center">
                <!-- 输入工具按钮 -->
                <div class="input-tools">
                    <button class="tool-button image-upload-btn" id="imageUploadBtn" title="上传图片">
                        <i class="fas fa-image"></i>
                    </button>
                    <button class="tool-button voice-btn" id="voiceBtn" title="语音输入">
                        <i class="fas fa-microphone"></i>
                    </button>
                </div>
                
                <div class="input-container flex-1 rounded-full px-4 py-2 flex items-center transition-all duration-300">
                    <!-- 文本输入框 -->
                    <input type="text" placeholder="输入您的消息..." class="bg-transparent border-none focus:outline-none flex-1 py-1 px-2 text-white placeholder-gray-500" id="messageInput">
                </div>
                
                <!-- 发送按钮 -->
                <button class="send-button text-white rounded-full w-10 h-10 flex items-center justify-center ml-3 shadow-lg" id="sendButton">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
            
            <div class="max-w-3xl mx-auto mt-2 text-xs text-gray-500 text-center fade-in">
                <p>异次元 AI 助手 - 探索未知的智能边界</p>
            </div>
        </div>
    </footer>

    <!-- 隐藏的文件输入 -->
    <input type="file" id="fileInput" class="file-input" accept="image/*" multiple>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const chatContainer = document.getElementById('chatContainer');
            const messageContainer = document.getElementById('messageContainer');
            const messageInput = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');
            const clearChatButton = document.getElementById('clearChat');
            const toggleSettingsButton = document.getElementById('toggleSettings');
            const showGuideButton = document.getElementById('showGuide');
            const settingsPanel = document.getElementById('settingsPanel');
            const aiProviderSelect = document.getElementById('aiProvider');
            const apiKeyInput = document.getElementById('apiKey');
            const deepseekModelSelect = document.getElementById('deepseekModel');
            const baseUrlInput = document.getElementById('baseUrl');
            const saveSettingsButton = document.getElementById('saveSettings');
            const testAPIButton = document.getElementById('testAPI');
            const testResultDiv = document.getElementById('testResult');
            const apiStatus = document.getElementById('apiStatus');
            const digitalClock = document.getElementById('digitalClock');
            
            // 新增功能元素
            const imageUploadBtn = document.getElementById('imageUploadBtn');
            const voiceBtn = document.getElementById('voiceBtn');
            const fileInput = document.getElementById('fileInput');
            const imagePreviewContainer = document.getElementById('imagePreviewContainer');
            
            // API提供商特定元素
            const deepseekSection = document.getElementById('deepseekSection');
            const openaiSection = document.getElementById('openaiSection');
            const openaiKeyInput = document.getElementById('openaiKey');
            const openaiModelSelect = document.getElementById('openaiModel');
            
            // 指南模态框元素
            const guideModal = document.getElementById('guideModal');
            const closeGuide = document.getElementById('closeGuide');
            const closeGuideBtn = document.getElementById('closeGuideBtn');
            
            // 应用设置
            let settings = {
                aiProvider: 'deepseek',
                apiKey: '',
                baseUrl: 'https://api.deepseek.com',
                deepseekModel: 'deepseek-chat',
                openaiKey: '',
                openaiModel: 'gpt-3.5-turbo'
            };
            
            // 语音识别
            let recognition = null;
            let isRecording = false;
            let uploadedImages = [];
            
            // 初始化语音识别
            function initSpeechRecognition() {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    recognition = new SpeechRecognition();
                    recognition.continuous = false;
                    recognition.interimResults = false;
                    recognition.lang = 'zh-CN';
                    
                    recognition.onresult = function(event) {
                        const transcript = event.results[0][0].transcript;
                        messageInput.value = transcript;
                        voiceBtn.classList.remove('recording');
                        isRecording = false;
                    };
                    
                    recognition.onerror = function(event) {
                        console.error('语音识别错误:', event.error);
                        voiceBtn.classList.remove('recording');
                        isRecording = false;
                        alert('语音识别失败，请重试');
                    };
                    
                    recognition.onend = function() {
                        voiceBtn.classList.remove('recording');
                        isRecording = false;
                    };
                } else {
                    voiceBtn.style.display = 'none';
                    console.warn('浏览器不支持语音识别');
                }
            }
            
            // 更新时钟函数
            function updateClock() {
                const now = new Date();
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const seconds = String(now.getSeconds()).padStart(2, '0');
                digitalClock.textContent = `${hours}:${minutes}:${seconds}`;
            }
            
            // 初始化时钟
            updateClock();
            setInterval(updateClock, 1000);
            
            // 从localStorage加载聊天记录和设置
            function loadChatHistoryAndSettings() {
                const savedChat = localStorage.getItem('aiChatHistory');
                const savedSettings = localStorage.getItem('aiChatSettings');
                
                if (savedChat) {
                    messageContainer.innerHTML = savedChat;
                } else {
                    // 如果没有保存的记录，显示默认欢迎消息
                    addAiMessage("您好！我是您的异次元 AI 助手，已连接到高级 AI 模型。我支持文本对话、图片分析和语音输入功能。请先在设置中配置您的 API 密钥。有什么我可以帮助您的吗？", true);
                }
                
                if (savedSettings) {
                    settings = JSON.parse(savedSettings);
                    aiProviderSelect.value = settings.aiProvider;
                    apiKeyInput.value = settings.apiKey;
                    deepseekModelSelect.value = settings.deepseekModel;
                    baseUrlInput.value = settings.baseUrl;
                    openaiKeyInput.value = settings.openaiKey;
                    openaiModelSelect.value = settings.openaiModel;
                    
                    // 根据选择的提供商显示/隐藏相关设置
                    toggleProviderSections();
                    updateAPIStatus();
                }
                
                scrollToBottom();
            }
            
            // 保存聊天记录到localStorage
            function saveChatHistory() {
                localStorage.setItem('aiChatHistory', messageContainer.innerHTML);
            }
            
            // 保存设置到localStorage
            function saveSettings() {
                localStorage.setItem('aiChatSettings', JSON.stringify(settings));
            }
            
            // 根据选择的AI提供商显示/隐藏相关设置
            function toggleProviderSections() {
                // 隐藏所有部分
                deepseekSection.style.display = 'none';
                openaiSection.style.display = 'none';
                
                // 显示选中的部分
                if (aiProviderSelect.value === 'deepseek') {
                    deepseekSection.style.display = 'block';
                    baseUrlInput.value = 'https://api.deepseek.com';
                } else if (aiProviderSelect.value === 'openai') {
                    openaiSection.style.display = 'block';
                    baseUrlInput.value = 'https://api.openai.com/v1';
                }
            }
            
            // 更新API状态显示
            function updateAPIStatus() {
                if (settings.aiProvider === 'deepseek') {
                    apiStatus.textContent = '异次元连接';
                    apiStatus.className = 'ml-2 stranger-badge text-xs font-medium px-2.5 py-0.5 rounded';
                } else if (settings.aiProvider === 'openai') {
                    apiStatus.textContent = 'OpenAI';
                    apiStatus.className = 'ml-2 bg-green-900 text-green-300 text-xs font-medium px-2.5 py-0.5 rounded';
                } else {
                    apiStatus.textContent = '模拟模式';
                    apiStatus.className = 'ml-2 bg-gray-700 text-gray-300 text-xs font-medium px-2.5 py-0.5 rounded';
                }
            }
            
            // 获取当前时间
            function getCurrentTime() {
                const now = new Date();
                return `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            }
            
            // 添加用户消息
            function addUserMessage(message, images = []) {
                const messageElement = document.createElement('div');
                messageElement.className = 'user-message mb-6 flex items-start justify-end';
                
                let contentHTML = `<p class="text-white">${message}</p>`;
                
                // 添加图片预览
                if (images.length > 0) {
                    contentHTML += '<div class="image-preview-container mt-2">';
                    images.forEach(imgData => {
                        contentHTML += `<img src="${imgData}" alt="上传的图片" class="uploaded-image">`;
                    });
                    contentHTML += '</div>';
                }
                
                contentHTML += `<span class="text-xs text-pink-200 mt-1 block">${getCurrentTime()}</span>`;
                
                messageElement.innerHTML = `
                    <div class="user-bubble message-bubble rounded-2xl rounded-tr-none px-4 py-3 max-w-[85%]">
                        ${contentHTML}
                    </div>
                    <div class="w-8 h-8 rounded-full bg-gradient-to-r from-purple-600 to-pink-600 flex items-center justify-center ml-3 flex-shrink-0 shadow-sm">
                        <i class="fas fa-user text-white text-xs"></i>
                    </div>
                `;
                messageContainer.appendChild(messageElement);
                scrollToBottom();
                saveChatHistory();
            }
            
            // 添加AI消息
            function addAiMessage(message, isWelcome = false) {
                const messageElement = document.createElement('div');
                messageElement.className = 'ai-message mb-6 flex items-start';
                messageElement.innerHTML = `
                    <div class="w-8 h-8 rounded-full bg-gradient-to-r from-blue-600 to-purple-600 flex items-center justify-center mr-3 flex-shrink-0 shadow-sm">
                        <i class="fas fa-robot text-white text-sm"></i>
                    </div>
                    <div class="ai-bubble message-bubble rounded-2xl rounded-tl-none px-4 py-3 max-w-[85%]">
                        <p class="text-white">${message}</p>
                        <span class="text-xs text-blue-300 mt-1 block">${getCurrentTime()}</span>
                    </div>
                `;
                
                if (isWelcome) {
                    messageContainer.appendChild(messageElement);
                } else {
                    // 移除正在输入指示器
                    hideTypingIndicator();
                    messageContainer.appendChild(messageElement);
                }
                
                scrollToBottom();
                saveChatHistory();
            }
            
            // 显示AI正在输入
            function showTypingIndicator() {
                const typingElement = document.createElement('div');
                typingElement.className = 'ai-message mb-6 flex items-start';
                typingElement.id = 'typingIndicator';
                typingElement.innerHTML = `
                    <div class="w-8 h-8 rounded-full bg-gradient-to-r from-blue-600 to-purple-600 flex items-center justify-center mr-3 flex-shrink-0 shadow-sm">
                        <i class="fas fa-robot text-white text-sm"></i>
                    </div>
                    <div class="ai-bubble message-bubble rounded-2xl rounded-tl-none px-4 py-3 max-w-[85%]">
                        <div class="typing-indicator">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>
                `;
                messageContainer.appendChild(typingElement);
                scrollToBottom();
            }
            
            // 隐藏AI正在输入
            function hideTypingIndicator() {
                const typingIndicator = document.getElementById('typingIndicator');
                if (typingIndicator) {
                    typingIndicator.remove();
                }
            }
            
            // 滚动到底部
            function scrollToBottom() {
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
            
            // 获取当前API密钥和模型
            function getCurrentAPIInfo() {
                const provider = aiProviderSelect.value;
                let apiKey, model, url;
                
                if (provider === 'deepseek') {
                    apiKey = apiKeyInput.value;
                    model = deepseekModelSelect.value;
                    url = baseUrlInput.value;
                } else if (provider === 'openai') {
                    apiKey = openaiKeyInput.value;
                    model = openaiModelSelect.value;
                    url = baseUrlInput.value;
                } else {
                    // 模拟模式
                    return { provider: 'mock' };
                }
                
                return { provider, apiKey, model, url };
            }
            
            // 发送消息到AI API
            async function sendMessageToAI(message, images = []) {
                const apiInfo = getCurrentAPIInfo();
                
                // 如果选择的是模拟模式，返回模拟响应
                if (apiInfo.provider === 'mock') {
                    return new Promise(resolve => {
                        setTimeout(() => {
                            const mockResponses = [
                                "这是一个很好的问题！让我为您详细解释一下...",
                                "根据我的理解，这个问题的答案是...",
                                "我很高兴您问这个问题！从我的角度来看...",
                                "这是一个复杂的话题，但我会尽力为您解答...",
                                "感谢您的提问！我认为这个问题的关键在于..."
                            ];
                            const randomResponse = mockResponses[Math.floor(Math.random() * mockResponses.length)];
                            resolve(randomResponse);
                        }, 1500);
                    });
                }
                
                // 检查API密钥
                if (!apiInfo.apiKey) {
                    throw new Error(`请先在设置中配置${apiInfo.provider} API密钥`);
                }
                
                try {
                    let response;
                    
                    if (apiInfo.provider === 'deepseek' || apiInfo.provider === 'openai') {
                        // 异次元AI和OpenAI兼容API
                        const requestBody = {
                            model: apiInfo.model,
                            messages: [
                                {
                                    role: 'system',
                                    content: '你是一个有帮助的AI助手。请用中文回答用户的问题。'
                                },
                                {
                                    role: 'user',
                                    content: message
                                }
                            ],
                            max_tokens: 4000,
                            temperature: 0.7,
                            stream: false
                        };
                        
                        // 如果有图片，添加图片描述到消息中
                        if (images.length > 0) {
                            requestBody.messages[1].content += `\n\n用户上传了 ${images.length} 张图片，请根据图片内容进行回答。`;
                        }
                        
                        // 异次元AI特定参数
                        if (apiInfo.provider === 'deepseek') {
                            requestBody.frequency_penalty = 0;
                            requestBody.presence_penalty = 0;
                            requestBody.top_p = 0.8;
                        }
                        
                        response = await fetch(`${apiInfo.url}/chat/completions`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${apiInfo.apiKey}`,
                                // 异次元AI特定头部
                                ...(apiInfo.provider === 'deepseek' && {
                                    'Accept': 'application/json'
                                })
                            },
                            body: JSON.stringify(requestBody)
                        });
                    }
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        let errorMessage = 'API请求失败';
                        try {
                            const errorData = JSON.parse(errorText);
                            errorMessage = errorData.error?.message || errorMessage;
                        } catch (e) {
                            errorMessage = `HTTP ${response.status}: ${errorText}`;
                        }
                        throw new Error(errorMessage);
                    }
                    
                    const data = await response.json();
                    
                    // 处理不同API的响应格式
                    if (apiInfo.provider === 'deepseek' || apiInfo.provider === 'openai') {
                        return data.choices[0].message.content;
                    }
                    
                    throw new Error('不支持的API提供商');
                } catch (error) {
                    console.error('API调用错误:', error);
                    
                    // 提供更友好的错误信息
                    let userFriendlyError = error.message;
                    
                    if (error.message.includes('401')) {
                        userFriendlyError = 'API密钥无效，请检查您的密钥是否正确';
                    } else if (error.message.includes('429')) {
                        userFriendlyError = '请求频率过高，请稍后再试';
                    } else if (error.message.includes('500')) {
                        userFriendlyError = '服务器内部错误，请稍后再试';
                    } else if (error.message.includes('model_not_found')) {
                        userFriendlyError = '所选模型不可用，请检查模型名称或切换其他模型';
                    } else if (error.message.includes('Failed to fetch')) {
                        userFriendlyError = '网络连接失败，请检查网络连接';
                    }
                    
                    throw new Error(userFriendlyError);
                }
            }
            
            // 处理图片上传
            function handleImageUpload(event) {
                const files = event.target.files;
                if (files.length === 0) return;
                
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    if (!file.type.startsWith('image/')) continue;
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imageData = e.target.result;
                        uploadedImages.push(imageData);
                        
                        // 显示图片预览
                        const imagePreview = document.createElement('div');
                        imagePreview.className = 'image-preview';
                        imagePreview.innerHTML = `
                            <img src="${imageData}" alt="预览图片" class="uploaded-image">
                            <button class="remove-image" data-index="${uploadedImages.length - 1}">
                                <i class="fas fa-times"></i>
                            </button>
                        `;
                        imagePreviewContainer.appendChild(imagePreview);
                        imagePreviewContainer.classList.remove('hidden');
                        
                        // 添加删除事件
                        imagePreview.querySelector('.remove-image').addEventListener('click', function() {
                            const index = parseInt(this.getAttribute('data-index'));
                            uploadedImages.splice(index, 1);
                            imagePreview.remove();
                            
                            // 更新所有删除按钮的索引
                            const removeButtons = imagePreviewContainer.querySelectorAll('.remove-image');
                            removeButtons.forEach((btn, idx) => {
                                btn.setAttribute('data-index', idx);
                            });
                            
                            if (uploadedImages.length === 0) {
                                imagePreviewContainer.classList.add('hidden');
                            }
                        });
                    };
                    reader.readAsDataURL(file);
                }
                
                // 重置文件输入
                fileInput.value = '';
            }
            
            // 语音输入处理
            function toggleVoiceInput() {
                if (!recognition) {
                    alert('您的浏览器不支持语音识别功能');
                    return;
                }
                
                if (isRecording) {
                    recognition.stop();
                    voiceBtn.classList.remove('recording');
                    isRecording = false;
                } else {
                    recognition.start();
                    voiceBtn.classList.add('recording');
                    isRecording = true;
                }
            }
            
            // 测试API连接
            async function testAPIConnection() {
                const apiInfo = getCurrentAPIInfo();
                
                if (apiInfo.provider === 'mock') {
                    showTestResult('模拟模式无需测试', 'info');
                    return;
                }
                
                if (!apiInfo.apiKey) {
                    showTestResult('请先输入API密钥', 'error');
                    return;
                }
                
                testAPIButton.disabled = true;
                testAPIButton.textContent = '测试中...';
                
                try {
                    // 发送一个简单的测试请求
                    const testMessage = "请回复'测试成功'";
                    const response = await sendMessageToAI(testMessage);
                    
                    if (response && response.includes('测试成功')) {
                        showTestResult('连接测试成功！', 'success');
                    } else {
                        showTestResult('响应异常', 'warning');
                    }
                } catch (error) {
                    showTestResult(`连接测试失败: ${error.message}`, 'error');
                } finally {
                    testAPIButton.disabled = false;
                    testAPIButton.textContent = '测试连接';
                }
            }
            
            // 显示测试结果
            function showTestResult(message, type) {
                testResultDiv.textContent = message;
                testResultDiv.className = 'mt-4 p-3 rounded-lg text-sm';
                
                if (type === 'success') {
                    testResultDiv.classList.add('test-success');
                } else if (type === 'error') {
                    testResultDiv.classList.add('test-failure');
                } else if (type === 'warning') {
                    testResultDiv.classList.add('bg-yellow-900', 'text-yellow-200');
                } else {
                    testResultDiv.classList.add('bg-blue-900', 'text-blue-200');
                }
                
                testResultDiv.classList.remove('hidden');
            }
            
            // 发送消息
            async function sendMessage() {
                const message = messageInput.value.trim();
                if (message === '' && uploadedImages.length === 0) return;
                
                // 添加用户消息
                addUserMessage(message || '[图片消息]', uploadedImages);
                
                // 清空输入框和图片
                messageInput.value = '';
                imagePreviewContainer.innerHTML = '';
                imagePreviewContainer.classList.add('hidden');
                
                // 显示AI正在输入
                showTypingIndicator();
                
                try {
                    // 发送到AI并获取响应
                    const aiResponse = await sendMessageToAI(message, uploadedImages);
                    addAiMessage(aiResponse);
                    
                    // 清空已上传的图片
                    uploadedImages = [];
                } catch (error) {
                    console.error('获取AI响应时出错:', error);
                    hideTypingIndicator();
                    addAiMessage(`抱歉，我遇到了一些问题: ${error.message}。请检查您的设置或稍后再试。`);
                }
            }
            
            // 清空聊天
            function clearChat() {
                if (confirm('确定要清空聊天记录吗？')) {
                    messageContainer.innerHTML = '';
                    uploadedImages = [];
                    imagePreviewContainer.innerHTML = '';
                    imagePreviewContainer.classList.add('hidden');
                    addAiMessage("您好！我是您的异次元 AI 助手，已连接到高级 AI 模型。我支持文本对话、图片分析和语音输入功能。请先在设置中配置您的 API 密钥。有什么我可以帮助您的吗？", true);
                    saveChatHistory();
                }
            }
            
            // 保存设置
            function saveSettingsToStorage() {
                settings.aiProvider = aiProviderSelect.value;
                settings.apiKey = apiKeyInput.value;
                settings.deepseekModel = deepseekModelSelect.value;
                settings.baseUrl = baseUrlInput.value;
                settings.openaiKey = openaiKeyInput.value;
                settings.openaiModel = openaiModelSelect.value;
                
                saveSettings();
                updateAPIStatus();
                
                // 关闭设置面板
                settingsPanel.classList.remove('open');
                
                alert('设置已保存！');
            }
            
            // 显示指南
            function showGuide() {
                guideModal.classList.add('open');
            }
            
            // 隐藏指南
            function hideGuide() {
                guideModal.classList.remove('open');
            }
            
            // 切换设置面板显示/隐藏
            function toggleSettingsPanel() {
                settingsPanel.classList.toggle('open');
            }
            
            // 事件监听
            sendButton.addEventListener('click', sendMessage);
            
            messageInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            clearChatButton.addEventListener('click', clearChat);
            
            toggleSettingsButton.addEventListener('click', toggleSettingsPanel);
            
            showGuideButton.addEventListener('click', showGuide);
            
            aiProviderSelect.addEventListener('change', toggleProviderSections);
            
            saveSettingsButton.addEventListener('click', saveSettingsToStorage);
            
            testAPIButton.addEventListener('click', testAPIConnection);
            
            closeGuide.addEventListener('click', hideGuide);
            closeGuideBtn.addEventListener('click', hideGuide);
            
            // 新增功能事件监听
            imageUploadBtn.addEventListener('click', function() {
                fileInput.click();
            });
            
            fileInput.addEventListener('change', handleImageUpload);
            
            voiceBtn.addEventListener('click', toggleVoiceInput);
            
            // 模型选择变化时更新模型信息
            deepseekModelSelect.addEventListener('change', function() {
                // 这里可以添加根据所选模型更新模型信息的逻辑
                console.log('选择的模型:', this.value);
            });
            
            // 初始化语音识别
            initSpeechRecognition();
            
            // 初始化
            loadChatHistoryAndSettings();
        });
    </script>
</body>
</html>